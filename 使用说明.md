# 多人实时模拟交易平台 - 使用说明

## 🎯 核心特性

### 多用户独立账户系统
- ✅ **每个用户独立计算**: 每个用户的盈亏、持仓、现金都是完全独立计算和存储的
- ✅ **共同影响市场**: 所有用户的买卖行为共同影响市场价格
- ✅ **实时同步**: 所有用户看到相同的市场价格曲线和交易活动
- ✅ **支持100+用户**: 优化后的服务器可以支持100人左右同时在线

## 📋 使用流程

### 1. 启动服务器
双击 `启动多人服务器.bat` 文件，或运行：
```bash
python server_multiplayer.py
```

### 2. 访问平台
在浏览器中打开：`http://localhost:1236`

### 3. 设置昵称
首次访问时，系统会提示您输入昵称。输入后点击"确定"即可开始交易。

### 4. 开始交易
- 点击 **BUY 1** 或 **BUY 2** 买入股票
- 点击 **SELL 1** 或 **SELL 2** 卖出股票
- 所有用户的交易行为会实时影响市场价格

## 👥 多人使用场景

### 局域网内使用
1. 服务器启动后，其他设备可以通过以下地址访问：
   ```
   http://[服务器IP地址]:1236
   ```
   例如：`http://192.168.1.100:1236`

2. 每个用户：
   - 输入自己的昵称
   - 独立进行交易
   - 看到所有用户的交易统计
   - 看到实时价格曲线（所有用户同步）

### 功能说明

#### 交易统计表格
- **YOU**: 您个人的交易统计（买入、卖出、净交易）
- **ALL USERS**: 所有在线用户的交易统计总和
- **MARKET**: 机器人交易者的交易统计

#### 在线用户面板（右上角）
- 显示当前在线用户数量
- 显示前15名用户的财富排行榜
- 您自己的排名会高亮显示

#### 财务指标
每个用户独立显示：
- **平均成本**: 您的平均持仓成本
- **已实现盈亏**: 您已平仓交易的盈亏
- **未实现盈亏**: 您当前持仓的浮动盈亏
- **持仓**: 您当前持有的股票数量

## 🔧 技术特点

### 独立账户管理
- 每个用户通过唯一的Socket ID标识
- 每个用户的数据存储在独立的字典中
- 每个用户的盈亏、持仓完全独立计算

### 市场影响机制
- 市场价格 = 500 + LAMBDA × (所有用户需求总和 + 机器人需求)
- 所有用户的买卖行为共同影响市场价格
- 但每个用户的账户数据完全独立

### 性能优化
- 限制历史数据大小（保留最近500个点）
- 只发送前15名用户信息以节省带宽
- 使用数据压缩减少网络传输
- 支持100+用户同时在线

## ⚠️ 注意事项

1. **首次使用**: 需要先安装依赖包（运行 `安装依赖.bat`）
2. **端口占用**: 确保端口1236未被占用
3. **网络访问**: 如需局域网访问，确保防火墙允许1236端口
4. **用户数据**: 用户断开连接后数据会保留，但标记为离线状态
5. **游戏时间**: 每局游戏280秒，结束后显示最终财富排名

## 🎮 教学场景应用

### 适合场景
- 金融实验课程
- 行为金融学研究
- 交易策略测试
- 市场微观结构研究

### 优势
- 所有学生看到相同的市场环境
- 每个学生的表现独立记录
- 可以观察群体行为对市场的影响
- 实时反馈，增强参与感
